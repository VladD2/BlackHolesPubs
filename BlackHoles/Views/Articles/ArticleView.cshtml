@using BlackHoles.DataContexts;
@using BlackHoles.Entities;
@using BlackHoles.Models;
@using BlackHoles.Utils;
@using System.Security.Principal;
@model BlackHoles.Entities.Article

@{
  IssuesDb db = new IssuesDb();
  var isCreating = ViewBag.Create;
}

@using (Html.BeginForm(isCreating ? "Create" : "Edit", "Articles", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
  @Html.AntiForgeryToken()

  <div class="form-horizontal">
    <h2 class="text-center">@ViewBag.Title</h2>
    <hr />
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
    @Html.HiddenFor(model => model.Id)
    @Html.HiddenFor(model => model.IssueYear)
    @Html.HiddenFor(model => model.IssueNumber)
    <div class="form-group">
      @Html.LabelFor(model => model.Specialty, htmlAttributes: new { @class = "control-label col-md-2" })
      <div class="col-md-10">
        @{
          var lst = new List<SelectListItem>()
          {
            new SelectListItem() { Text="Выберите номер специальности...", Disabled=true, Selected=true },
            new SelectListItem() { Value="12.00.01", Text="12.00.01 – Теория и история права и государства; история учений о праве и государстве" },
            new SelectListItem() { Value="12.00.02", Text="12.00.02 – Конституционное право; конституционный судебный процесс; муниципальное право" },
            new SelectListItem() { Value="12.00.03", Text="12.00.03 – Гражданское право; предпринимательское право; семейное право; международное частное право" },
            new SelectListItem() { Value="12.00.04", Text="12.00.04 – Финансовое право; налоговое право; бюджетное право" },
            new SelectListItem() { Value="12.00.05", Text="12.00.05 – Трудовое право; право социального обеспечения" },
            new SelectListItem() { Value="12.00.06", Text="12.00.06 – Земельное право; природоресурсное право; экологическое право; аграрное право" },
            new SelectListItem() { Value="12.00.07", Text="12.00.07 – Корпоративное право; энергетическое право" },
            new SelectListItem() { Value="12.00.08", Text="12.00.08 – Уголовное право и криминология; уголовно - исполнительное право" },
            new SelectListItem() { Value="12.00.09", Text="12.00.09 – Уголовный процесс" },
            new SelectListItem() { Value="12.00.10", Text="12.00.10 – Международное право; Европейское право" },
            new SelectListItem() { Value="12.00.11", Text="12.00.11 – Судебная деятельность, прокурорская деятельность, правозащитная и правоохранительная деятельность" },
            new SelectListItem() { Value="12.00.12", Text="12.00.12 – Криминалистика; судебно - экспертная деятельность; оперативно - розыскная деятельность" },
            new SelectListItem() { Value="12.00.13", Text="12.00.13 – Информационное право" },
            new SelectListItem() { Value="12.00.14", Text="12.00.14 – Административное право; административный процесс" },
            new SelectListItem() { Value="12.00.15", Text="12.00.15 – Гражданский процесс; арбитражный процесс" },
          };
        }
        @Html.DropDownListFor(model => model.Specialty, lst, new { htmlAttributes = new { @class = "form-control" } })
        @Html.ValidationMessageFor(model => model.Specialty, "", new { @class = "text-danger" })
      </div>
    </div>

    <p class="label-info">Следующие поля заплняются на <b>русском</b> языке:</p>

    <div class="form-group">
      @Html.LabelFor(model => model.RusArtTitles, htmlAttributes: new { @class = "control-label col-md-2" })
      <div class="col-md-10">
        @Html.EditorFor(model => model.RusArtTitles, new { htmlAttributes = new { @class = "form-control" } })
        @Html.ValidationMessageFor(model => model.RusArtTitles, "", new { @class = "text-danger" })
      </div>
    </div>

    <div class="form-group">
      @Html.LabelFor(model => model.Authors, "Автор(ы)", htmlAttributes: new { @class = "control-label col-md-2" })
      <div class="col-md-10">
        @Html.HiddenFor(model => model.AuthorsIds)
        @Html.Partial("AuthorList", Model.AuthorsViewModel)
      </div>
    </div>

    <div class="form-group">
      @Html.LabelFor(model => model.ShortArtTitles, htmlAttributes: new { @class = "control-label col-md-2", title = "Отображается в списке статей и используется для именования файла." })
      <div class="col-md-10">
        @Html.EditorFor(model => model.ShortArtTitles, new { htmlAttributes = new { @class = "form-control" } })
        @Html.ValidationMessageFor(model => model.ShortArtTitles, "", new { @class = "text-danger" })
      </div>
    </div>

    <div class="form-group">
      @Html.LabelFor(model => model.RusAbstract, htmlAttributes: new { @class = "control-label col-md-2" })
      <div class="col-md-10">
        @Html.EditorFor(model => model.RusAbstract, new { htmlAttributes = new { @class = "form-control" } })
        @Html.ValidationMessageFor(model => model.RusAbstract, "", new { @class = "text-danger" })
      </div>
    </div>

    <div class="form-group">
      @Html.LabelFor(model => model.RusKeywords, htmlAttributes: new { @class = "control-label col-md-2" })
      <div class="col-md-10">
        @Html.EditorFor(model => model.RusKeywords, new { htmlAttributes = new { @class = "form-control" } })
        @Html.ValidationMessageFor(model => model.RusKeywords, "", new { @class = "text-danger" })
      </div>
    </div>

    <p class="label-info">Следующие поля заплняются на <b>английском</b> языке:</p>

    <div class="form-group">
      @Html.LabelFor(model => model.EnuArtTitles, htmlAttributes: new { @class = "control-label col-md-2" })
      <div class="col-md-10">
        @Html.EditorFor(model => model.EnuArtTitles, new { htmlAttributes = new { @class = "form-control" } })
        @Html.ValidationMessageFor(model => model.EnuArtTitles, "", new { @class = "text-danger" })
      </div>
    </div>

    <div class="form-group">
      @Html.LabelFor(model => model.EnuAbstract, htmlAttributes: new { @class = "control-label col-md-2" })
      <div class="col-md-10">
        @Html.EditorFor(model => model.EnuAbstract, new { htmlAttributes = new { @class = "form-control" } })
        @Html.ValidationMessageFor(model => model.EnuAbstract, "", new { @class = "text-danger" })
      </div>
    </div>

    <div class="form-group">
      @Html.LabelFor(model => model.EnuKeywords, htmlAttributes: new { @class = "control-label col-md-2" })
      <div class="col-md-10">
        @Html.EditorFor(model => model.EnuKeywords, new { htmlAttributes = new { @class = "form-control" } })
        @Html.ValidationMessageFor(model => model.EnuKeywords, "", new { @class = "text-danger" })
      </div>
    </div>

    @if (!isCreating)
    {
      <div class="form-group">
        @Html.Label("файлы прилагаемые к статье", htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
          <div class="@dangerIfZero(Model.ArticleVersions)">Загружено версий текста статьи: @Model.ArticleVersions.@filePrompt(Model.ArticleVersions)</div>
          <div class="@dangerIfZero(Model.ReviewTextVersions)">Загружено версий текста рецензии/решения ученого совета: @Model.ReviewTextVersions.@filePrompt(Model.ReviewTextVersions)</div>
          <div class="@dangerIfZero(Model.ReviewImgVersions)">Загружено версий фото/скана рецензии/решения ученого совета: @Model.ReviewImgVersions.@filePrompt(Model.ReviewImgVersions)</div>
        </div>
        @helper dangerIfZero(int count)
        {
          @(count == 0 ? "text-danger" : "text-success")
        }
        @helper filePrompt(int count)
        {
          if (count == 0)
          {
            @: <b>Загрузите файл!</b>
          }
        }
      </div>
    }

    <div>
      <table class="btn">
        <tr nowrap>
          <td>
            <input type="file" name="articleFile" id="articleFile" accept=".doc,.rtf,.txt,.docx" class="filestyle" data-placeholder="файл не выбран!" data-buttonBefore="true" data-buttonText="Выберите файл статьи..." />
            @Html.ValidationMessage("articleFile", "", new { @class = "text-danger" })
          </td>

        </tr>
        <tr nowrap>
          <td><input type="file" name="additionalTextFile" id="additionalText" accept=".doc,.rtf,.txt,.docx" class="filestyle" data-placeholder="файл не выбран!" data-buttonBefore="true" data-buttonText="Выберите файл рецензии (текст)..." /></td>
        </tr>
        <tr nowrap>
          <td><input type="file" name="additionalImg" id="additionalImg" accept=".png,.gif,.jpg,.jpeg,.tiff,.pdf" class="filestyle" data-placeholder="файл не выбран!" data-buttonBefore="true" data-buttonText="Выберите файл рецензии (фото/скан)..." /></td>
        </tr>
      </table>
    </div>

    <div>
      <h4>Комментарии:</h4>
      @{ ViewBag.ArticleId = Model.Id; }
      <textarea cols="30" rows="3" name="commentText_@(Model.Id)" id="commentText_@(Model.Id)" placeholder="Введите текст коментария..."></textarea>
      <input type="submit" id="addComment" value="Добавить комментарий" class="btn btn-primary" onclick="addComment(@Model.Id)" />
      @Html.Partial("MessageTree", Model.Messages)
    </div>

    <div class="form-group">
      <div class="col-md-offset-2 col-md-10">
        @Shared.BackButton()&nbsp;&nbsp;<input type="submit" value="Сохранить" class="btn btn-primary" />
      </div>
    </div>
  </div>
}

